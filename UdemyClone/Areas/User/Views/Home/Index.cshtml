@model CategoryCourseViewModel
@using System.Security.Claims;
@inject UdemyClone.DataAccess.Interfaces.IUnitOfWork _unitOfWork


@{
    ViewData["Title"] = "Online Course - Learn Anything";
}

<div class="bg-white">
    <!-- Banner -->
    <div class="relative bg-cover bg-center" style="background-image: url('/img/hero-banner.png');">
        <div class="container mx-auto px-4 py-16 sm:py-24">
            <div class="grid grid-cols-1 items-center gap-8 md:grid-cols-2">
                <div class="p-8 text-white">
                    <h1 class="text-4xl leading-tight font-bold text-gray-950 md:text-5xl">
                        Build Skills with Online Course
                    </h1>
                    <p class="mt-4 text-lg text-gray-600 md:text-xl">
                        Get the skills and real-world experience employers want with EduPress.
                    </p>
                    <button type="button" class="mt-2 cursor-pointer rounded-lg bg-orange-500 px-8 py-3 font-bold text-white shadow-md transition duration-300 hover:bg-orange-600">Explore Now</button>
                </div>
            </div>
        </div>
    </div>

    <div class="px-50 py-4">
        <!-- Category-->
        <div class="py-12">
            <div class="mb-12 text-center">
                <div class="mb-3 text-3xl font-bold text-gray-900">Top Categories</div>
                <span class="text-lg text-gray-600">Explore our Popular Categories</span>
                <div class="mx-auto mt-4 h-1 w-24 bg-gradient-to-r from-orange-400 to-orange-600"></div>
            </div>
            <div class="mt-6 grid grid-cols-2 gap-6 md:grid-cols-3 lg:grid-cols-5">
                @foreach (var category in Model.Category)
                {
                    <div class="group aspect-square cursor-pointer rounded-lg border border-gray-200 bg-white p-6 shadow-sm transition-all duration-300 hover:-translate-y-3 hover:border-orange-300 hover:shadow-lg">
                        <!-- Icon container without background -->
                        <div class="flex h-full flex-col items-center justify-center">
                            <div class="mb-4">
                                @switch (category.Name)
                                {
                                    case "Music":
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-headphones-icon lucide-headphones h-12 w-12 text-orange-500"><path d="M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3" /></svg>
                                        break;
                                    case "Development":
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="h-12 w-12 text-orange-500">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5" />
                                        </svg>
                                        break;
                                    case "Office Productivity":
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-spreadsheet-icon lucide-file-spreadsheet h-12 w-12 text-orange-500"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><path d="M8 13h2" /><path d="M14 13h2" /><path d="M8 17h2" /><path d="M14 17h2" /></svg>
                                        break;
                                    case "IT & Software":
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-monitor-icon lucide-monitor h-12 w-12 text-orange-500"><rect width="20" height="14" x="2" y="3" rx="2" /><line x1="8" x2="16" y1="21" y2="21" /><line x1="12" x2="12" y1="17" y2="21" /></svg>
                                        break;
                                    case "Design":
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil-ruler-icon lucide-pencil-ruler h-12 w-12 text-orange-500"><path d="M13 7 8.7 2.7a2.41 2.41 0 0 0-3.4 0L2.7 5.3a2.41 2.41 0 0 0 0 3.4L7 13" /><path d="m8 6 2-2" /><path d="m18 16 2-2" /><path d="m17 11 4.3 4.3c.94.94.94 2.46 0 3.4l-2.6 2.6c-.94.94-2.46.94-3.4 0L11 17" /><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" /><path d="m15 5 4 4" /></svg>
                                        break;
                                    case "Personal Development":
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-brain-icon lucide-brain h-12 w-12 text-orange-500"><path d="M12 18V5" /><path d="M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4" /><path d="M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5" /><path d="M17.997 5.125a4 4 0 0 1 2.526 5.77" /><path d="M18 18a4 4 0 0 0 2-7.464" /><path d="M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517" /><path d="M6 18a4 4 0 0 1-2-7.464" /><path d="M6.003 5.125a4 4 0 0 0-2.526 5.77" /></svg>
                                        break;
                                    case "Health & Fitness":
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dumbbell-icon lucide-dumbbell h-12 w-12 text-orange-500"><path d="M17.596 12.768a2 2 0 1 0 2.829-2.829l-1.768-1.767a2 2 0 0 0 2.828-2.829l-2.828-2.828a2 2 0 0 0-2.829 2.828l-1.767-1.768a2 2 0 1 0-2.829 2.829z" /><path d="m2.5 21.5 1.4-1.4" /><path d="m20.1 3.9 1.4-1.4" /><path d="M5.343 21.485a2 2 0 1 0 2.829-2.828l1.767 1.768a2 2 0 1 0 2.829-2.829l-6.364-6.364a2 2 0 1 0-2.829 2.829l1.768 1.767a2 2 0 0 0-2.828 2.829z" /><path d="m9.6 14.4 4.8-4.8" /></svg>
                                        break;
                                    case "Finance & Accounting":
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-bar-icon lucide-chart-bar h-12 w-12 text-orange-500"><path d="M3 3v16a2 2 0 0 0 2 2h16" /><path d="M7 16h8" /><path d="M7 11h12" /><path d="M7 6h3" /></svg>
                                        break;
                                    case "Business":
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-briefcase-icon lucide-briefcase h-12 w-12 text-orange-500"><path d="M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" /><rect width="20" height="14" x="2" y="6" rx="2" /></svg>
                                        break;
                                    case "Marketing":
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-megaphone-icon lucide-megaphone h-12 w-12 text-orange-500"><path d="M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z" /><path d="M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14" /><path d="M8 6v8" /></svg>
                                        break;
                                }
                            </div>

                            <!-- Category name -->
                            <div class="text-center">
                                <h3 class="text-sm font-semibold text-gray-800 transition-colors duration-300 group-hover:text-orange-600">
                                    @category.Name
                                </h3>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Featured Courses -->
        <div class="py-12">
            <div class="flex items-center justify-between">
                <div>
                    <div class="mb-3 text-3xl font-bold text-gray-900">Featured Courses</div>
                    <div class="text-lg text-gray-600">Explore Popular Courses</div>
                </div>
                <button class="cursor-pointer rounded-3xl border border-gray-900 px-5 py-2 font-medium transition-colors hover:bg-gray-900 hover:text-white">All Courses</button>
            </div>

            <!-- Course Grid -->
            <div class="mt-8 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
                @foreach (var course in Model.Course.Take(9))
                {
                    
                    <div class="group relative">
                        <!-- Course Card -->
                        <a target="_blank" asp-area="User" asp-controller="Course" asp-action="Index" asp-route-id="@course.Id" class="block cursor-pointer overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm transition-all duration-300 hover:shadow-xl">
                            <!-- Course Image with Overlay Badge -->
                            <div class="relative aspect-video overflow-hidden">
                                @if (!string.IsNullOrEmpty(course.ImageUrl))
                                {
                                    <img src="@course.ImageUrl" alt="@course.Title" class="h-full w-full object-cover transition-all duration-300 group-hover:brightness-75">
                                }
                                else
                                {
                                    <div class="flex h-full w-full items-center justify-center bg-gray-200">
                                        <svg class="h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                }

                                <!-- Subcategory Badge -->
                                @if (course.Subcategory != null)
                                {
                                    <div class="absolute top-5 left-5">
                                        <span class="bg-opacity-80 rounded bg-black p-3 text-xs font-medium text-white backdrop-blur-sm">
                                            @course.Subcategory.Name
                                        </span>
                                    </div>
                                }
                            </div>

                            <div class="p-4">
                                <!-- Instructor Name -->
                                <div class="border-b border-gray-300 pb-3">
                                    @if (course.Instructor?.ApplicationUser != null)
                                    {
                                        <div class="mb-2 flex items-center space-x-2">
                                            <div class="text-sm font-medium text-gray-600">
                                                <span class="font-normal">by</span>
                                                <span>@course.Instructor.ApplicationUser.FirstName @course.Instructor.ApplicationUser.LastName</span>
                                            </div>
                                        </div>
                                    }

                                    <!-- Course Title -->
                                    <h3 class="mb-3 line-clamp-2 text-lg font-semibold text-gray-900 transition-colors group-hover:text-orange-600">
                                        @course.Title
                                    </h3>

                                    <!-- Course Duration -->
                                    @if (course.Duration.HasValue)
                                    {
                                        <span class="flex items-center space-x-1 text-sm font-medium text-gray-600">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-4 w-4 text-orange-500">
                                                <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z" clip-rule="evenodd" />
                                            </svg>
                                            <span>
                                                @if (course.Duration.Value.TotalHours >= 1)
                                                {
                                                    @($"{(int)course.Duration.Value.TotalHours}h {course.Duration.Value.Minutes}m")
                                                }
                                                else
                                                {
                                                    @($"{course.Duration.Value.Minutes}m")
                                                }
                                            </span>
                                        </span>
                                    }
                                </div>

                                <!-- Price and Enrollment Button -->
                                <div class="flex items-center justify-between pt-3">
                                    <div class="flex items-center space-x-2">
                                        @if (course.Price.HasValue && course.Price.Value > 0)
                                        {
                                            <span class="text-xl font-bold text-red-500">$@course.Price.Value</span>
                                        }
                                        else
                                        {
                                            <span class="text-xl font-bold text-green-600">Free</span>
                                        }
                                    </div>
                                    <span class="text-sm font-medium text-gray-900 hover:text-orange-500">
                                        View More
                                    </span>
                                </div>
                            </div>
                        </a>

                        <!-- Course Popover -->
                        <div class="invisible absolute top-1/2 left-full z-50 ml-4 w-85 -translate-y-1/2 scale-95 transform rounded-lg border border-gray-200 bg-white p-6 opacity-0 shadow-xl transition-all duration-300 group-hover:visible group-hover:scale-100 group-hover:opacity-100">
                            <!-- Popover Title -->
                            <h4 class="mb-1 line-clamp-2 text-lg font-semibold text-gray-900">
                                @course.Title
                            </h4>

                            <!-- Course Meta Information -->
                            <div class="mb-2 space-y-2">
                                <!-- Update Date -->
                                @if (course.UpdatedAt.HasValue)
                                {
                                    <div class="flex items-center text-xs text-green-800">
                                        <div>Updated <span class="font-bold">@course.UpdatedAt.Value.ToString("MMM yyyy")</span></div>
                                    </div>
                                }

                                <!-- Course Level -->
                                @if (course.CourseLevel != null)
                                {
                                    <div class="flex items-center text-sm text-gray-600">
                                        <svg class="mr-2 h-4 w-4 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        <span>@course.CourseLevel.Name</span>
                                    </div>
                                }
                            </div>

                            <!-- Course Description -->
                            @if (!string.IsNullOrEmpty(course.Description))
                            {
                                <div class="mb-2">
                                    <p class="line-clamp-3 text-sm text-gray-700">
                                        @course.Subtitle
                                    </p>
                                </div>
                            }

                            <!-- Top Three Outcomes -->
                            @if (course.CourseOutcomes != null && course.CourseOutcomes.Any())
                            {
                                <div class="mb-4">
                                    <h5 class="mb-2 text-sm font-semibold text-gray-900">What you'll learn</h5>
                                    <ul class="space-y-1">
                                        @foreach (var outcome in course.CourseOutcomes.OrderBy(o => o.DisplayOrder).Take(3))
                                        {
                                            <li class="flex items-start text-sm text-gray-700">
                                                <svg class="mt-0.5 mr-2 h-3 w-3 flex-shrink-0 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                                </svg>
                                                <span class="line-clamp-2">@outcome.Title</span>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            }

                            <!-- Action Buttons -->
                            <div class="space-y-3">
                                @{
                                    var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
                                    var isInCart = userId != null && _unitOfWork.Cart.Get(c => c.ApplicationUserId == userId && c.CourseId == course.Id) != null;
                                }
                                @if (isInCart)
                                {
                                    <a asp-area="User" asp-controller="Cart" asp-action="Index" class="block w-full rounded-lg bg-orange-600 py-2.5 text-center text-sm font-semibold text-white transition-colors hover:bg-orange-700">
                                        Go to cart
                                    </a>
                                }
                                else
                                {
                                    <button class="add-to-cart w-full cursor-pointer rounded-lg bg-orange-600 py-2.5 text-sm font-semibold text-white transition-colors hover:bg-orange-700"
                                            data-course-id="@course.Id"
                                            data-course-title="@course.Title"
                                            data-course-image="@(course.ImageUrl ?? "/img/course-image-placeholder.webp")"
                                            data-instructor-name="@(course.Instructor?.ApplicationUser != null ? $"{course.Instructor.ApplicationUser.FirstName} {course.Instructor.ApplicationUser.LastName}" : "Unknown Instructor")"
                                            data-course-price="@(course.Price.HasValue && course.Price.Value > 0 ? $"${course.Price.Value}" : "Free")">
                                        Add to cart
                                    </button>
                                }
                                
                                <button class="w-full cursor-pointer rounded-lg border border-gray-300 bg-white py-2.5 text-sm font-semibold text-gray-700 transition-colors hover:bg-gray-50" onclick="event.stopPropagation();">
                                    <svg class="mr-1 inline-block h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                    </svg>
                                    Add to Wishlist
                                </button>
                            </div>

                            <!-- Popover Arrow -->
                            <div class="absolute top-1/2 -left-2 h-4 w-4 rotate-45 transform border-b border-l border-gray-200 bg-white"></div>
                        </div>
                    </div>
                }
            </div>

        </div>

    </div>
</div>

@section Scripts{
    <script src="~/js/add-to-cart.js"></script>
}