@model IEnumerable<Course>

<div class="mb-8 flex items-center justify-between">
    <div class="w-[400px]">
        <div>
            <label for="default-search" class="sr-only mb-2 text-sm font-medium text-gray-900">Search</label>
            <div class="relative">
                <div class="pointer-events-none absolute inset-y-0 start-0 flex items-center ps-3">
                    <svg class="h-4 w-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                    </svg>
                </div>
                <input type="search" id="default-search" class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-4 ps-10 text-sm text-gray-900 focus:outline-orange-500" placeholder="Search your courses" value="@(ViewBag.CurrentSearch)" />
                <button type="button" id="search-course-btn" class="absolute end-2.5 bottom-2.5 cursor-pointer rounded-lg bg-orange-500 px-4 py-2 text-sm font-medium text-white hover:bg-orange-600">Search</button>
            </div>
        </div>
    </div>
    <a asp-action="Create" asp-route-step="1" class="rounded-lg bg-orange-500 px-4 py-2 text-sm font-medium text-white hover:bg-orange-600">New course</a>
</div>

<!-- Sort -->
<div class="mb-6 flex sm:flex-row sm:items-center sm:justify-between">
    <div class="flex items-center gap-3">
        <span class="text-sm font-medium text-gray-700">Sort by:</span>
        <div class="relative">
            <button type="button" id="sortDropdown" class="flex min-w-[180px] cursor-pointer items-center justify-between rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm shadow-sm transition-all hover:border-orange-400 focus:border-orange-500 focus:ring-2 focus:ring-orange-500 focus:outline-none">
                <span id="sortText" class="text-gray-900">
                    @{
                        var sortText = ViewBag.CurrentSort switch
                        {
                            "created-asc" => "Oldest First",
                            "title-asc" => "Title (A-Z)", 
                            "title-desc" => "Title (Z-A)",
                            "updated-desc" => "Recently Updated",
                            "price-desc" => "Price (High to Low)",
                            "price-asc" => "Price (Low to High)",
                            _ => "Newest First"
                        };
                    }
                    @sortText
                </span>
                <svg class="ml-2 h-4 w-4 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            <div id="sortMenu" class="absolute right-0 z-20 mt-1 hidden w-full min-w-[180px] rounded-lg border border-gray-200 bg-white shadow-lg">
                <div class="py-1">
                    <div class="cursor-pointer px-4 py-2 text-sm text-gray-900 hover:bg-orange-50 hover:text-orange-600 @(ViewBag.CurrentSort == "created-desc" ? "bg-orange-50 text-orange-600" : "")" data-value="created-desc">
                        Newest First
                    </div>
                    <div class="cursor-pointer px-4 py-2 text-sm text-gray-900 hover:bg-orange-50 hover:text-orange-600 @(ViewBag.CurrentSort == "created-asc" ? "bg-orange-50 text-orange-600" : "")" data-value="created-asc">
                        Oldest First
                    </div>
                    <div class="cursor-pointer px-4 py-2 text-sm text-gray-900 hover:bg-orange-50 hover:text-orange-600 @(ViewBag.CurrentSort == "title-asc" ? "bg-orange-50 text-orange-600" : "")" data-value="title-asc">
                        Title (A-Z)
                    </div>
                    <div class="cursor-pointer px-4 py-2 text-sm text-gray-900 hover:bg-orange-50 hover:text-orange-600 @(ViewBag.CurrentSort == "title-desc" ? "bg-orange-50 text-orange-600" : "")" data-value="title-desc">
                        Title (Z-A)
                    </div>
                    <div class="cursor-pointer px-4 py-2 text-sm text-gray-900 hover:bg-orange-50 hover:text-orange-600 @(ViewBag.CurrentSort == "updated-desc" ? "bg-orange-50 text-orange-600" : "")" data-value="updated-desc">
                        Recently Updated
                    </div>
                    <div class="cursor-pointer px-4 py-2 text-sm text-gray-900 hover:bg-orange-50 hover:text-orange-600 @(ViewBag.CurrentSort == "price-desc" ? "bg-orange-50 text-orange-600" : "")" data-value="price-desc">
                        Price (High to Low)
                    </div>
                    <div class="cursor-pointer px-4 py-2 text-sm text-gray-900 hover:bg-orange-50 hover:text-orange-600 @(ViewBag.CurrentSort == "price-asc" ? "bg-orange-50 text-orange-600" : "")" data-value="price-asc">
                        Price (Low to High)
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

@if (Model.Any())
{
    <div id="coursesContainer" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        @foreach (var course in Model.ToList())
        {
            <div class="course-card flex flex-col rounded-lg border border-gray-200 bg-white shadow-md transition-shadow duration-300 hover:shadow-lg">
                <div class="relative">
                    @if (!string.IsNullOrEmpty(course.ImageUrl))
                    {
                        <img class="course-image h-48 w-full rounded-t-lg object-cover" src="@course.ImageUrl" alt="@course.Title" />
                    }
                    else
                    {
                        <img class="course-image h-48 w-full rounded-t-lg object-cover" src="~/img//course-image-placeholder.webp" alt="@course.Title" />
                    }

                    @{
                        string statusClass = course.Status switch
                        {
                            "Published" => "bg-green-100 text-green-800",
                            "Draft" => "bg-yellow-100 text-yellow-800",
                            "Private" => "bg-gray-100 text-gray-800",
                            _ => "bg-gray-100 text-gray-800"
                        };
                    }

                    <span class="absolute top-2 right-2 rounded-full px-2 py-1 text-xs font-semibold @statusClass">
                        @course.Status
                    </span>
                </div>

                <div class="course-content grid flex-1 grid-rows-[auto_auto_auto_auto_auto_auto] gap-3 px-4 pt-4 pb-2">
                    <h3 class="course-title line-clamp-2 min-h-[3.5rem] text-lg font-semibold text-gray-900">@course.Title</h3>

                    @if (!string.IsNullOrEmpty(course.Subtitle))
                    {
                        <p class="course-subtitle line-clamp-2 min-h-[2.5rem] text-sm text-gray-600">@course.Subtitle</p>
                    }
                    else
                    {
                        <div class="course-subtitle min-h-[2.5rem]"></div>
                    }

                    <div class="course-dates flex items-center justify-between text-sm text-gray-500">
                        <span>Created: @course.CreatedAt.ToString("MMM dd, yyyy")</span>
                        @if (course.UpdatedAt.HasValue)
                        {
                            <span>Updated: @course.UpdatedAt.Value.ToString("MMM dd, yyyy")</span>
                        }
                    </div>

                    @if (course.Price.HasValue)
                    {
                        <div class="course-price">
                            <span class="text-lg font-bold text-orange-600">$@course.Price.Value.ToString("F2")</span>
                        </div>
                    }
                    else
                    {
                        <div class="course-price">
                            <span class="text-lg font-bold text-green-500">Free</span>
                        </div>
                    }

                    <div class="course-actions mt-auto flex">
                        <a asp-action="Manage" asp-route-id="@course.Id" asp-route-section="intended-learners"
                           class="flex-1 rounded-lg bg-blue-500 px-3 py-2 text-center text-sm font-medium text-white transition-colors duration-200 hover:bg-blue-600">
                            Edit
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <!-- No Courses Found -->
    <div class="py-12 text-center">
        <div class="mb-4 text-gray-400">
            <svg class="mx-auto h-16 w-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
            </svg>
        </div>
        <h3 class="mb-2 text-lg font-medium text-gray-900">No courses found</h3>
        <p class="mb-4 text-gray-600">
            @if (!string.IsNullOrEmpty(ViewBag.CurrentSearch))
            {
                <span>We couldn't find any courses matching "@ViewBag.CurrentSearch".</span>
            }
            else
            {
                <span>You haven't created any courses yet.</span>
            }
        </p>
        <a asp-action="Create" asp-route-step="1" class="inline-flex items-center rounded-lg bg-orange-600 px-4 py-2 text-sm font-medium text-white hover:bg-orange-700">
            <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Create Your First Course
        </a>
    </div>
}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const url = new URL(window.location);
        const btnSearchCourse = document.getElementById('search-course-btn');
        const sortDropdown = document.getElementById('sortDropdown');
        const sortMenu = document.getElementById('sortMenu');
        const sortText = document.getElementById('sortText');
        const arrow = sortDropdown.querySelector('svg');

        btnSearchCourse.addEventListener('click', () => {
            const searchValue = document.getElementById('default-search').value;
            url.searchParams.set('search', searchValue);
            window.location.href = url.toString();
        });

        document.getElementById('default-search').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const searchValue = this.value;
                url.searchParams.set('search', searchValue);
                window.location.href = url.toString();
            }
        });

        sortDropdown.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            sortMenu.classList.toggle('hidden');
            arrow.classList.toggle('rotate-180');
        });

        sortMenu.querySelectorAll('[data-value]').forEach(function(option) {
            option.addEventListener('click', function(e) {
                e.preventDefault();
                const sortValue = this.getAttribute('data-value');
                const displayText = this.textContent.trim();
                
                sortText.textContent = displayText;
                
                sortMenu.querySelectorAll('[data-value]').forEach(opt => {
                    opt.classList.remove('bg-orange-50', 'text-orange-600');
                });
                this.classList.add('bg-orange-50', 'text-orange-600');
                
                sortMenu.classList.add('hidden');
                arrow.classList.remove('rotate-180');
                
                url.searchParams.set('sort', sortValue);
                window.location.href = url.toString();
            });
        });

        document.addEventListener('click', function() {
            sortMenu.classList.add('hidden');
            arrow.classList.remove('rotate-180');
        });
    });
</script>