@page
@model IndexModel
@{
    ViewData["Title"] = "Profile Settings";
    ViewData["ActivePage"] = ManageNavPages.Index;
}

<div class="mx-auto max-w-4xl bg-white px-4 py-8">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Profile Settings</h1>
        <p class="mt-2 text-gray-600">Manage your personal information and account settings</p>
    </div>

    <!-- Status Message -->
    <partial name="_StatusMessage" for="StatusMessage" />

    <form id="profile-form" method="post" enctype="multipart/form-data">
        <div asp-validation-summary="ModelOnly" class="mb-4 rounded-lg bg-red-50 p-4 text-sm text-red-800" role="alert"></div>

        <!-- User Information Section -->
        <div class="mb-8 rounded-lg border border-gray-200 bg-white shadow-sm">
            <div class="border-b border-gray-200 bg-gray-50 px-6 py-4">
                <h2 class="flex items-center text-lg font-semibold text-gray-900">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 h-5 w-5 text-orange-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                    Basic Information
                </h2>
            </div>
            <div class="p-6">
                <!-- Profile Picture -->
                <div class="mb-8 flex items-center gap-6">
                    <div class="relative">
                        @if (!string.IsNullOrEmpty(Model.Input.CurrentAvatarUrl))
                        {
                            <img id="avatarPreview" src="@Model.Input.CurrentAvatarUrl" alt="Profile Picture" class="h-32 w-32 rounded-full border-4 border-orange-500 object-cover shadow-lg" />
                        }
                        else
                        {
                            <div id="avatarPreview" class="flex h-32 w-32 items-center justify-center rounded-full border-4 border-orange-500 bg-gray-200 shadow-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                                    <circle cx="12" cy="7" r="4" />
                                </svg>
                            </div>
                        }
                        <label for="avatarInput" class="absolute right-0 bottom-0 flex h-10 w-10 cursor-pointer items-center justify-center rounded-full border-2 border-white bg-orange-500 text-white shadow-lg hover:bg-orange-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                                <circle cx="12" cy="13" r="4" />
                            </svg>
                        </label>
                    </div>
                    <div class="flex-1">
                        <input asp-for="Input.AvatarFile" type="file" id="avatarInput" accept="image/*" class="hidden" onchange="previewAvatar(this)" />
                        <input asp-for="Input.CurrentAvatarUrl" type="hidden" />
                        <h3 class="mb-1 text-lg font-semibold text-gray-900">Profile Picture</h3>
                        <p class="mb-3 text-sm text-gray-600">Upload a professional photo. JPG, PNG or GIF (max 5MB)</p>
                        <div class="flex gap-2">
                            <button type="button" onclick="document.getElementById('avatarInput').click()" class="cursor-pointer rounded-lg border border-orange-500 px-4 py-2 text-sm font-medium text-orange-500 hover:bg-orange-50">
                                Choose Photo
                            </button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                    <!-- First Name -->
                    <div>
                        <label asp-for="Input.FirstName" class="mb-2 block text-sm font-medium text-gray-700">
                            First Name <span class="text-red-500">*</span>
                        </label>
                        <input asp-for="Input.FirstName" class="w-full rounded-lg border border-gray-300 px-4 py-2.5 text-gray-900 focus:border-orange-500 focus:ring-2 focus:ring-orange-500 focus:outline-none" placeholder="Enter your first name" />
                        <span asp-validation-for="Input.FirstName" class="mt-1 text-sm text-red-600"></span>
                    </div>

                    <!-- Last Name -->
                    <div>
                        <label asp-for="Input.LastName" class="mb-2 block text-sm font-medium text-gray-700">
                            Last Name <span class="text-red-500">*</span>
                        </label>
                        <input asp-for="Input.LastName" class="w-full rounded-lg border border-gray-300 px-4 py-2.5 text-gray-900 focus:border-orange-500 focus:ring-2 focus:ring-orange-500 focus:outline-none" placeholder="Enter your last name" />
                        <span asp-validation-for="Input.LastName" class="mt-1 text-sm text-red-600"></span>
                    </div>

                    <!-- Email -->
                    <div>
                        <label class="mb-2 block text-sm font-medium text-gray-700">
                            Email Address
                        </label>
                        <input type="text" value="@Model.Username" class="w-full rounded-lg border border-gray-300 bg-gray-100 px-4 py-2.5 text-gray-600" disabled readonly />
                        <p class="mt-1 text-xs text-gray-500">Email cannot be changed</p>
                    </div>

                    <!-- Phone -->
                    <div>
                        <label asp-for="Input.PhoneNumber" class="mb-2 block text-sm font-medium text-gray-700">
                            Phone Number
                        </label>
                        <input asp-for="Input.PhoneNumber" class="w-full rounded-lg border border-gray-300 px-4 py-2.5 text-gray-900 focus:border-orange-500 focus:ring-2 focus:ring-orange-500 focus:outline-none" placeholder="Enter your phone number" />
                        <span asp-validation-for="Input.PhoneNumber" class="mt-1 text-sm text-red-600"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructor Information Section -->
        @if (Model.IsInstructor)
        {
            <div class="mb-8 rounded-lg border border-gray-200 bg-white shadow-sm">
                <div class="border-b border-gray-200 bg-gray-50 px-6 py-4">
                    <h2 class="flex items-center text-lg font-semibold text-gray-900">
                        <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 h-5 w-5 text-orange-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                        </svg>
                        Instructor Profile
                    </h2>
                    <p class="mt-1 text-sm text-gray-600">This information will be displayed on your public instructor profile</p>
                </div>
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- Headline -->
                        <div>
                            <label asp-for="Input.Headline" class="mb-2 block text-sm font-medium text-gray-700">
                                Professional Headline
                            </label>
                            <input asp-for="Input.Headline" class="w-full rounded-lg border border-gray-300 px-4 py-2.5 text-gray-900 focus:border-orange-500 focus:ring-2 focus:ring-orange-500 focus:outline-none" placeholder="e.g., Full Stack Developer & Instructor" maxlength="100" />
                            <span asp-validation-for="Input.Headline" class="mt-1 text-sm text-red-600"></span>
                            <p class="mt-1 text-xs text-gray-500">A brief, professional tagline (max 100 characters)</p>
                        </div>

                        <!-- Biography -->
                        <div>
                            <label asp-for="Input.Biography" class="mb-2 block text-sm font-medium text-gray-700">
                                Biography
                            </label>
                            <textarea asp-for="Input.Biography" rows="6" class="w-full rounded-lg border border-gray-300 px-4 py-2.5 text-gray-900 focus:border-orange-500 focus:ring-2 focus:ring-orange-500 focus:outline-none" placeholder="Tell students about yourself, your experience, and what you're passionate about teaching..." maxlength="1000"></textarea>
                            <span asp-validation-for="Input.Biography" class="mt-1 text-sm text-red-600"></span>
                            <p class="mt-1 text-xs text-gray-500">Share your background and expertise (max 1000 characters)</p>
                        </div>

                        <!-- Website -->
                        <div>
                            <label asp-for="Input.Website" class="mb-2 block text-sm font-medium text-gray-700">
                                Website URL
                            </label>
                            <div class="relative">
                                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10" />
                                        <line x1="2" y1="12" x2="22" y2="12" />
                                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                                    </svg>
                                </div>
                                <input asp-for="Input.Website" type="url" class="w-full rounded-lg border border-gray-300 py-2.5 pr-4 pl-10 text-gray-900 focus:border-orange-500 focus:ring-2 focus:ring-orange-500 focus:outline-none" placeholder="https://www.example.com" />
                            </div>
                            <span asp-validation-for="Input.Website" class="mt-1 text-sm text-red-600"></span>
                            <p class="mt-1 text-xs text-gray-500">Your personal or professional website</p>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Action Buttons -->
        <div class="flex items-center justify-between gap-4 border-t border-gray-200 pt-6">
            <a asp-area="User" asp-controller="Home" asp-action="Index" class="rounded-lg border border-gray-300 px-6 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50">
                Cancel
            </a>
            <button type="submit" class="flex cursor-pointer items-center gap-2 rounded-lg bg-orange-500 px-6 py-2.5 text-sm font-semibold text-white hover:bg-orange-600 focus:ring-4 focus:ring-orange-300 focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                    <polyline points="17 21 17 13 7 13 7 21" />
                    <polyline points="7 3 7 8 15 8" />
                </svg>
                Save Changes
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function previewAvatar(input) {
            const preview = document.getElementById('avatarPreview');
            const file = input.files[0];
            
            if (file) {
                // Check file size (5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB');
                    input.value = '';
                    return;
                }

                // Check file type
                if (!file.type.match('image.*')) {
                    alert('Please select an image file');
                    input.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    // Check if preview is an img element or div
                    if (preview.tagName === 'IMG') {
                        preview.src = e.target.result;
                    } else {
                        // Replace div with img
                        const img = document.createElement('img');
                        img.id = 'avatarPreview';
                        img.src = e.target.result;
                        img.className = 'h-32 w-32 rounded-full border-4 border-orange-500 object-cover shadow-lg';
                        preview.parentNode.replaceChild(img, preview);
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function removeAvatar() {
            if (confirm('Are you sure you want to remove your profile picture?')) {
                const preview = document.getElementById('avatarPreview');
                const input = document.getElementById('avatarInput');
                
                // Reset file input
                input.value = '';
                
                // Replace img with default icon
                const div = document.createElement('div');
                div.id = 'avatarPreview';
                div.className = 'flex h-32 w-32 items-center justify-center rounded-full border-4 border-orange-500 bg-gray-200 shadow-lg';
                div.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                `;
                
                if (preview.tagName === 'IMG') {
                    preview.parentNode.replaceChild(div, preview);
                }
                
                // Set hidden field to empty to signal deletion
                document.querySelector('input[name="Input.CurrentAvatarUrl"]').value = '';
            }
        }
    </script>
}
